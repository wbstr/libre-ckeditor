CKEDITOR.dialog.add("base64imageDialog",function(b){function r(d){if("string"==typeof d&&d){var a=new Image;a.src=d;a.onload=function(){b.plugins.imageresize&&b.plugins.imageresize.resize(b,this);f.getElement().setHtml("");null==g||null==e?(c.setValueOf("tab-properties","width","100"),c.setValueOf("tab-properties","height",Math.round(this.height/this.width*100))):(c.setValueOf("tab-properties","width",g),c.setValueOf("tab-properties","height",e));this.id=b.id+"previewimage";this.setAttribute("style",
"max-width:400px;max-height:100px;");this.setAttribute("alt","");try{var d=f.getElement().$;d&&d.appendChild(this)}catch(a){}};a.onerror=function(){f.getElement().setHtml("")};a.onabort=function(){f.getElement().setHtml("")}}else f.getElement().setHtml("")}function t(){f.getElement().setHtml("");var d=c.getContentElement("tab-source","file"),a=null;try{a=d.getInputElement().$}catch(b){a=null}a&&"files"in a&&a.files&&0<a.files.length&&a.files[0]&&(!("type"in a.files[0])||a.files[0].type.match("image.*"))&&
FileReader&&(f.getElement().setHtml("Betöltés..."),d=new FileReader,d.onload=function(a){return function(a){f.getElement().setHtml("");r(a.target.result)}}(a.files[0]),d.onerror=function(){f.getElement().setHtml("")},d.onabort=function(){f.getElement().setHtml("")},d.readAsDataURL(a.files[0]))}function n(){var a={w:c.getContentElement("tab-properties","width").getValue(),h:c.getContentElement("tab-properties","height").getValue()};a.w=parseInt(a.w,10);a.h=parseInt(a.h,10);isNaN(a.w)&&(a.w=0);isNaN(a.h)&&
(a.h=0);return a}function p(a){var b=n();"width"==a?b.h=Math.round(b.w/k):b.w=Math.round(b.h*k);c.getContentElement("tab-properties","width").setValue(b.w);c.getContentElement("tab-properties","height").setValue(b.h)}function q(a){var b=a.getValue(),b=parseInt(b,10);isNaN(b)&&(b=0);a.setValue(b+"%")}var c=null,a=null,g=null,e=null,f=null,k=1,l=!0,u=[{type:"file",id:"file",label:"",onChange:function(){t()}},{type:"html",id:"preview",html:(new CKEDITOR.template('\x3cdiv style\x3d"text-align:center;"\x3e\x3c/div\x3e')).output()}];
return{title:b.lang.common.image,minWidth:450,minHeight:180,onLoad:function(){this.getContentElement("tab-source","url");f=this.getContentElement("tab-source","preview");this.getContentElement("tab-properties","lock").getInputElement().on("click",function(){(l=this.getValue()?!0:!1)&&p("width")},this.getContentElement("tab-properties","lock"));this.getContentElement("tab-properties","width").getInputElement().on("keyup",function(){100<n().w?(alert("A kép túl széles, maximum 100% állítható be."),CKEDITOR.dialog.getCurrent().disableButton("ok")):
(CKEDITOR.dialog.getCurrent().enableButton("ok"),l&&p("width"))});this.getContentElement("tab-properties","height").getInputElement().on("keyup",function(){100<n().h?(alert("A kép túl magas, maximum 100% állítható be."),CKEDITOR.dialog.getCurrent().disableButton("ok")):(CKEDITOR.dialog.getCurrent().enableButton("ok"),l&&p("height"))});this.getContentElement("tab-properties","vmargin").getInputElement().on("keyup",function(){q(this)},this.getContentElement("tab-properties","vmargin"));this.getContentElement("tab-properties",
"hmargin").getInputElement().on("keyup",function(){q(this)},this.getContentElement("tab-properties","hmargin"));this.getContentElement("tab-properties","border").getInputElement().on("keyup",function(){q(this)},this.getContentElement("tab-properties","border"))},onShow:function(){f.getElement().setHtml("");c=this;e=g=null;k=1;l=!0;(a=b.getSelection())&&(a=a.getSelectedElement());a&&"img"===a.getName()||(a=null);c.setValueOf("tab-properties","lock",l);c.setValueOf("tab-properties","vmargin","0");c.setValueOf("tab-properties",
"hmargin","0");c.setValueOf("tab-properties","border","0");c.setValueOf("tab-properties","align","none");if(a){"string"==typeof a.getAttribute("width")&&(g=a.getAttribute("width"));"string"==typeof a.getAttribute("height")&&(e=a.getAttribute("height"));null!=g&&null!=e||!a.$||(g=a.$.width,e=a.$.height);null!=g&&null!=e&&(c.setValueOf("tab-properties","width",g),c.setValueOf("tab-properties","height",e),g=parseInt(g,10),e=parseInt(e,10),k=1,!isNaN(g)&&!isNaN(e)&&0<e&&0<g&&(k=g/e),0>=k&&(k=1));"string"==
typeof a.getAttribute("src")&&(0===a.getAttribute("src").indexOf("data:")?(t("base64"),r(a.getAttribute("src"))):c.setValueOf("tab-source","url",a.getAttribute("src")));"string"==typeof a.getAttribute("alt")&&c.setValueOf("tab-properties","alt",a.getAttribute("alt"));"string"==typeof a.getAttribute("hspace")&&c.setValueOf("tab-properties","hmargin",a.getAttribute("hspace"));"string"==typeof a.getAttribute("vspace")&&c.setValueOf("tab-properties","vmargin",a.getAttribute("vspace"));"string"==typeof a.getAttribute("border")&&
c.setValueOf("tab-properties","border",a.getAttribute("border"));if("string"==typeof a.getAttribute("align"))switch(a.getAttribute("align")){case "top":case "text-top":c.setValueOf("tab-properties","align","top");break;case "baseline":case "bottom":case "text-bottom":c.setValueOf("tab-properties","align","bottom");break;case "left":c.setValueOf("tab-properties","align","left");break;case "right":c.setValueOf("tab-properties","align","right")}c.selectPage("tab-properties")}},onOk:function(){var d=
"";try{d=CKEDITOR.document.getById(b.id+"previewimage").$.src}catch(g){d=""}if("string"==typeof d&&null!=d&&""!==d){var e=a?a:b.document.createElement("img");e.setAttribute("src",d);e.setAttribute("alt",c.getValueOf("tab-properties","alt").replace(/^\s+/,"").replace(/\s+$/,""));var d={width:["width","width:#;","integer",1],height:["height","height:#;","integer",1],vmargin:["vspace","margin-top:#;margin-bottom:#;","integer",0],hmargin:["hspace","margin-left:#;margin-right:#;","integer",0],align:["align",
""],border:["border","border:# solid black;","integer",0]},f=[],h,k,l,m;for(m in d){k=l=h=c.getValueOf("tab-properties",m);if("align"==m)switch(h){case "top":case "bottom":d[m][1]="vertical-align:#;";break;case "left":case "right":d[m][1]="float:#;";break;default:h=null}"integer"==d[m][2]&&(h=parseInt(h,10),isNaN(h)?h=null:h<d[m][3]&&(h=null),null!=h&&(l=h+"%",k=h+"%"));null!=h&&(e.setAttribute(d[m][0],l),f.push(d[m][1].replace(/#/g,k)))}0<f.length&&e.setAttribute("style",f.join(""));a||b.insertElement(e)}},
contents:[{id:"tab-source",label:b.lang.common.generalTab,elements:u},{id:"tab-properties",label:b.lang.common.advancedTab,elements:[{type:"text",id:"alt",label:b.lang.base64image.alt},{type:"hbox",widths:["15%","15%","70%"],children:[{type:"text",width:"45px",id:"width",label:b.lang.common.width},{type:"text",width:"45px",id:"height",label:b.lang.common.height},{type:"checkbox",id:"lock",label:b.lang.base64image.lockRatio,style:"margin-top:18px;"}]},{type:"hbox",widths:["23%","30%","30%","17%"],
style:"margin-top:10px;",children:[{type:"select",id:"align",label:b.lang.common.align,items:[[b.lang.common.notSet,"none"],[b.lang.common.alignTop,"top"],[b.lang.common.alignBottom,"bottom"],[b.lang.common.alignLeft,"left"],[b.lang.common.alignRight,"right"]]},{type:"text",width:"45px",id:"vmargin",label:b.lang.base64image.vSpace},{type:"text",width:"45px",id:"hmargin",label:b.lang.base64image.hSpace},{type:"text",width:"45px",id:"border",label:b.lang.base64image.border}]}]}]}});