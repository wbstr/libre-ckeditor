CKEDITOR.dialog.add("base64imageDialog",function(c){function t(a){if("string"==typeof a&&a){var d=new Image;d.src=a;d.onload=function(){if(this.width>c.config.imageMaxWidth||this.height>c.config.imageMaxheight){var a=document.createElement("canvas"),d=a.getContext("2d");a.width=c.config.imageMaxWidth;a.height=a.width*this.height/this.width;d.drawImage(this,0,0,a.width,a.height);this.src=a.toDataURL()}g.getElement().setHtml("");null==f||null==h?(e.setValueOf("tab-properties","width",this.width),e.setValueOf("tab-properties",
"height",this.height),k=1,0<this.height&&0<this.width&&(k=this.width/this.height),0>=k&&(k=1)):h=f=null;this.id=c.id+"previewimage";this.setAttribute("style","max-width:400px;max-height:100px;");this.setAttribute("alt","");try{var b=g.getElement().$;b&&b.appendChild(this)}catch(n){}};d.onerror=function(){g.getElement().setHtml("")};d.onabort=function(){g.getElement().setHtml("")}}else g.getElement().setHtml("")}function u(){g.getElement().setHtml("");var a=e.getContentElement("tab-source","file"),
d=null;try{d=a.getInputElement().$}catch(b){d=null}d&&"files"in d&&d.files&&0<d.files.length&&d.files[0]&&(!("type"in d.files[0])||d.files[0].type.match("image.*"))&&FileReader&&(g.getElement().setHtml("Betöltés..."),a=new FileReader,a.onload=function(a){return function(a){g.getElement().setHtml("");t(a.target.result)}}(d.files[0]),a.onerror=function(){g.getElement().setHtml("")},a.onabort=function(){g.getElement().setHtml("")},a.readAsDataURL(d.files[0]))}function p(){var a={w:e.getContentElement("tab-properties",
"width").getValue(),h:e.getContentElement("tab-properties","height").getValue(),uw:"px",uh:"px"};0<=a.w.indexOf("%")&&(a.uw="%");0<=a.h.indexOf("%")&&(a.uh="%");a.w=parseInt(a.w,10);a.h=parseInt(a.h,10);isNaN(a.w)&&(a.w=0);isNaN(a.h)&&(a.h=0);return a}function q(a){var d=p(),b="px";"width"==a?("%"==d.uw&&(b="%"),d.h=Math.round(d.w/k)):("%"==d.uh&&(b="%"),d.w=Math.round(d.h*k));"%"==b&&(d.w+="%",d.h+="%");e.getContentElement("tab-properties","width").setValue(d.w);e.getContentElement("tab-properties",
"height").setValue(d.h)}function r(a){var b=a.getValue(),c="";0<=b.indexOf("%")&&(c="%");b=parseInt(b,10);isNaN(b)&&(b=0);a.setValue(b+c)}var e=null,b=null,f=null,h=null,g=null,k=1,n=!0,v=[{type:"file",id:"file",label:"",onChange:function(){u()}},{type:"html",id:"preview",html:(new CKEDITOR.template('\x3cdiv style\x3d"text-align:center;"\x3e\x3c/div\x3e')).output()}];return{title:c.lang.common.image,minWidth:450,minHeight:180,onLoad:function(){this.getContentElement("tab-source","url");g=this.getContentElement("tab-source",
"preview");this.getContentElement("tab-properties","lock").getInputElement().on("click",function(){(n=this.getValue()?!0:!1)&&q("width")},this.getContentElement("tab-properties","lock"));this.getContentElement("tab-properties","width").getInputElement().on("keyup",function(){var a=p();"px"==a.uw&&a.w>c.config.imageMaxWidth?(alert("A kép túl széles, maximum "+c.config.imageMaxWidth+"px állítható be."),CKEDITOR.dialog.getCurrent().disableButton("ok")):"%"==a.uw&&100<a.w?(alert("A kép túl széles, maximum 100% állítható be."),
CKEDITOR.dialog.getCurrent().disableButton("ok")):(CKEDITOR.dialog.getCurrent().enableButton("ok"),n&&q("width"))});this.getContentElement("tab-properties","height").getInputElement().on("keyup",function(){var a=p();"px"==a.uh&&a.h>c.config.imageMaxHeight?(alert("A kép túl magas, maximum "+c.config.imageMaxHeight+"px állítható be."),CKEDITOR.dialog.getCurrent().disableButton("ok")):"%"==a.uh&&100<a.h?(alert("A kép túl magas, maximum 100% állítható be."),CKEDITOR.dialog.getCurrent().disableButton("ok")):
(CKEDITOR.dialog.getCurrent().enableButton("ok"),n&&q("height"))});this.getContentElement("tab-properties","vmargin").getInputElement().on("keyup",function(){r(this)},this.getContentElement("tab-properties","vmargin"));this.getContentElement("tab-properties","hmargin").getInputElement().on("keyup",function(){r(this)},this.getContentElement("tab-properties","hmargin"));this.getContentElement("tab-properties","border").getInputElement().on("keyup",function(){r(this)},this.getContentElement("tab-properties",
"border"))},onShow:function(){g.getElement().setHtml("");e=this;h=f=null;k=1;n=!0;(b=c.getSelection())&&(b=b.getSelectedElement());b&&"img"===b.getName()||(b=null);e.setValueOf("tab-properties","lock",n);e.setValueOf("tab-properties","vmargin","0");e.setValueOf("tab-properties","hmargin","0");e.setValueOf("tab-properties","border","0");e.setValueOf("tab-properties","align","none");if(b){"string"==typeof b.getAttribute("width")&&(f=b.getAttribute("width"));"string"==typeof b.getAttribute("height")&&
(h=b.getAttribute("height"));null!=f&&null!=h||!b.$||(f=b.$.width,h=b.$.height);null!=f&&null!=h&&(e.setValueOf("tab-properties","width",f),e.setValueOf("tab-properties","height",h),f=parseInt(f,10),h=parseInt(h,10),k=1,!isNaN(f)&&!isNaN(h)&&0<h&&0<f&&(k=f/h),0>=k&&(k=1));"string"==typeof b.getAttribute("src")&&(0===b.getAttribute("src").indexOf("data:")?(u("base64"),t(b.getAttribute("src"))):e.setValueOf("tab-source","url",b.getAttribute("src")));"string"==typeof b.getAttribute("alt")&&e.setValueOf("tab-properties",
"alt",b.getAttribute("alt"));"string"==typeof b.getAttribute("hspace")&&e.setValueOf("tab-properties","hmargin",b.getAttribute("hspace"));"string"==typeof b.getAttribute("vspace")&&e.setValueOf("tab-properties","vmargin",b.getAttribute("vspace"));"string"==typeof b.getAttribute("border")&&e.setValueOf("tab-properties","border",b.getAttribute("border"));if("string"==typeof b.getAttribute("align"))switch(b.getAttribute("align")){case "top":case "text-top":e.setValueOf("tab-properties","align","top");
break;case "baseline":case "bottom":case "text-bottom":e.setValueOf("tab-properties","align","bottom");break;case "left":e.setValueOf("tab-properties","align","left");break;case "right":e.setValueOf("tab-properties","align","right")}e.selectPage("tab-properties")}},onOk:function(){var a="";try{a=CKEDITOR.document.getById(c.id+"previewimage").$.src}catch(d){a=""}if("string"==typeof a&&null!=a&&""!==a){var f=b?b:c.document.createElement("img");f.setAttribute("src",a);f.setAttribute("alt",e.getValueOf("tab-properties",
"alt").replace(/^\s+/,"").replace(/\s+$/,""));var a={width:["width","width:#;","integer",1],height:["height","height:#;","integer",1],vmargin:["vspace","margin-top:#;margin-bottom:#;","integer",0],hmargin:["hspace","margin-left:#;margin-right:#;","integer",0],align:["align",""],border:["border","border:# solid black;","integer",0]},h=[],l,g,k,m;for(m in a){g=k=l=e.getValueOf("tab-properties",m);unit="px";if("align"==m)switch(l){case "top":case "bottom":a[m][1]="vertical-align:#;";break;case "left":case "right":a[m][1]=
"float:#;";break;default:l=null}"integer"==a[m][2]&&(0<=l.indexOf("%")&&(unit="%"),l=parseInt(l,10),isNaN(l)?l=null:l<a[m][3]&&(l=null),null!=l&&("%"==unit?(k=l+"%",g=l+"%"):(k=l,g=l+"px")));null!=l&&(f.setAttribute(a[m][0],k),h.push(a[m][1].replace(/#/g,g)))}0<h.length&&f.setAttribute("style",h.join(""));b||c.insertElement(f);c.plugins.imageresize&&c.plugins.imageresize.resize(c,f,800,800)}},contents:[{id:"tab-source",label:c.lang.common.generalTab,elements:v},{id:"tab-properties",label:c.lang.common.advancedTab,
elements:[{type:"text",id:"alt",label:c.lang.base64image.alt},{type:"hbox",widths:["15%","15%","70%"],children:[{type:"text",width:"45px",id:"width",label:c.lang.common.width},{type:"text",width:"45px",id:"height",label:c.lang.common.height},{type:"checkbox",id:"lock",label:c.lang.base64image.lockRatio,style:"margin-top:18px;"}]},{type:"hbox",widths:["23%","30%","30%","17%"],style:"margin-top:10px;",children:[{type:"select",id:"align",label:c.lang.common.align,items:[[c.lang.common.notSet,"none"],
[c.lang.common.alignTop,"top"],[c.lang.common.alignBottom,"bottom"],[c.lang.common.alignLeft,"left"],[c.lang.common.alignRight,"right"]]},{type:"text",width:"45px",id:"vmargin",label:c.lang.base64image.vSpace},{type:"text",width:"45px",id:"hmargin",label:c.lang.base64image.hSpace},{type:"text",width:"45px",id:"border",label:c.lang.base64image.border}]}]}]}});