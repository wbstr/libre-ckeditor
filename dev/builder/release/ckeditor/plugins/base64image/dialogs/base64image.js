CKEDITOR.dialog.add("base64imageDialog",function(c){function q(a){if("string"==typeof a&&a){var b=new Image;b.src=a;b.onload=function(){if(this.width>c.config.imageMaxWidth||this.height>c.config.imageMaxheight){var a=document.createElement("canvas"),b=a.getContext("2d");a.width=c.config.imageMaxWidth;a.height=a.width*this.height/this.width;b.drawImage(this,0,0,a.width,a.height);this.src=a.toDataURL()}f.getElement().setHtml("");null==k||null==e?(d.setValueOf("tab-properties","width",this.width),d.setValueOf("tab-properties",
"height",this.height),h=1,0<this.height&&0<this.width&&(h=this.width/this.height),0>=h&&(h=1)):e=k=null;this.id=c.id+"previewimage";this.setAttribute("style","max-width:400px;max-height:100px;");this.setAttribute("alt","");try{var r=f.getElement().$;r&&r.appendChild(this)}catch(l){}};b.onerror=function(){f.getElement().setHtml("")};b.onabort=function(){f.getElement().setHtml("")}}else f.getElement().setHtml("")}function t(){f.getElement().setHtml("");var a=d.getContentElement("tab-source","file"),
b=null;try{b=a.getInputElement().$}catch(c){b=null}b&&"files"in b&&b.files&&0<b.files.length&&b.files[0]&&(!("type"in b.files[0])||b.files[0].type.match("image.*"))&&FileReader&&(f.getElement().setHtml("Betöltés..."),a=new FileReader,a.onload=function(a){return function(a){f.getElement().setHtml("");q(a.target.result)}}(b.files[0]),a.onerror=function(){f.getElement().setHtml("")},a.onabort=function(){f.getElement().setHtml("")},a.readAsDataURL(b.files[0]))}function n(){var a={w:d.getContentElement("tab-properties",
"width").getValue(),h:d.getContentElement("tab-properties","height").getValue(),uw:"px",uh:"px"};0<=a.w.indexOf("%")&&(a.uw="%");0<=a.h.indexOf("%")&&(a.uh="%");a.w=parseInt(a.w,10);a.h=parseInt(a.h,10);isNaN(a.w)&&(a.w=0);isNaN(a.h)&&(a.h=0);return a}function p(a){var b=a.getValue(),c="";0<=b.indexOf("%")&&(c="%");b=parseInt(b,10);isNaN(b)&&(b=0);a.setValue(b+c)}var d=null,b=null,k=null,e=null,f=null,h=1,l=!0,u=[{type:"file",id:"file",label:"",onChange:function(){t()}},{type:"html",id:"preview",
html:(new CKEDITOR.template('\x3cdiv style\x3d"text-align:center;"\x3e\x3c/div\x3e')).output()}];return{title:c.lang.common.image,minWidth:450,minHeight:180,onLoad:function(){this.getContentElement("tab-source","url");f=this.getContentElement("tab-source","preview");this.getContentElement("tab-properties","lock").getInputElement().on("click",function(){if(l=this.getValue()?!0:!1){var a=n(),b="px";"%"==a.uw&&(b="%");a.h=Math.round(a.w/h);"%"==b&&(a.w+="%",a.h+="%");d.getContentElement("tab-properties",
"width").setValue(a.w);d.getContentElement("tab-properties","height").setValue(a.h)}},this.getContentElement("tab-properties","lock"));this.getContentElement("tab-properties","width").getInputElement().on("keyup",function(){var a=n();"px"==a.uw&&a.w>c.config.imageMaxWidth?(alert("A kép túl széles, maximum "+c.config.imageMaxWidth+"px állítható be."),CKEDITOR.dialog.getCurrent().disableButton("ok")):"%"==a.uw&&100<a.w?(alert("A kép túl széles, maximum 100% állítható be."),CKEDITOR.dialog.getCurrent().disableButton("ok")):
(CKEDITOR.dialog.getCurrent().enableButton("ok"),l&&a("width"))});this.getContentElement("tab-properties","height").getInputElement().on("keyup",function(){var a=n();"px"==a.uh&&a.h>c.config.imageMaxHeight?(alert("A kép túl magas, maximum "+c.config.imageMaxHeight+"px állítható be."),CKEDITOR.dialog.getCurrent().disableButton("ok")):"%"==a.uh&&100<a.h?(alert("A kép túl magas, maximum 100% állítható be."),CKEDITOR.dialog.getCurrent().disableButton("ok")):(CKEDITOR.dialog.getCurrent().enableButton("ok"),
l&&a("height"))});this.getContentElement("tab-properties","vmargin").getInputElement().on("keyup",function(){p(this)},this.getContentElement("tab-properties","vmargin"));this.getContentElement("tab-properties","hmargin").getInputElement().on("keyup",function(){p(this)},this.getContentElement("tab-properties","hmargin"));this.getContentElement("tab-properties","border").getInputElement().on("keyup",function(){p(this)},this.getContentElement("tab-properties","border"))},onShow:function(){f.getElement().setHtml("");
d=this;e=k=null;h=1;l=!0;(b=c.getSelection())&&(b=b.getSelectedElement());b&&"img"===b.getName()||(b=null);d.setValueOf("tab-properties","lock",l);d.setValueOf("tab-properties","vmargin","0");d.setValueOf("tab-properties","hmargin","0");d.setValueOf("tab-properties","border","0");d.setValueOf("tab-properties","align","none");if(b){"string"==typeof b.getAttribute("width")&&(k=b.getAttribute("width"));"string"==typeof b.getAttribute("height")&&(e=b.getAttribute("height"));null!=k&&null!=e||!b.$||(k=
b.$.width,e=b.$.height);null!=k&&null!=e&&(d.setValueOf("tab-properties","width",k),d.setValueOf("tab-properties","height",e),k=parseInt(k,10),e=parseInt(e,10),h=1,!isNaN(k)&&!isNaN(e)&&0<e&&0<k&&(h=k/e),0>=h&&(h=1));"string"==typeof b.getAttribute("src")&&(0===b.getAttribute("src").indexOf("data:")?(t("base64"),q(b.getAttribute("src"))):d.setValueOf("tab-source","url",b.getAttribute("src")));"string"==typeof b.getAttribute("alt")&&d.setValueOf("tab-properties","alt",b.getAttribute("alt"));"string"==
typeof b.getAttribute("hspace")&&d.setValueOf("tab-properties","hmargin",b.getAttribute("hspace"));"string"==typeof b.getAttribute("vspace")&&d.setValueOf("tab-properties","vmargin",b.getAttribute("vspace"));"string"==typeof b.getAttribute("border")&&d.setValueOf("tab-properties","border",b.getAttribute("border"));if("string"==typeof b.getAttribute("align"))switch(b.getAttribute("align")){case "top":case "text-top":d.setValueOf("tab-properties","align","top");break;case "baseline":case "bottom":case "text-bottom":d.setValueOf("tab-properties",
"align","bottom");break;case "left":d.setValueOf("tab-properties","align","left");break;case "right":d.setValueOf("tab-properties","align","right")}d.selectPage("tab-properties")}},onOk:function(){var a="";try{a=CKEDITOR.document.getById(c.id+"previewimage").$.src}catch(k){a=""}if("string"==typeof a&&null!=a&&""!==a){var e=b?b:c.document.createElement("img");e.setAttribute("src",a);e.setAttribute("alt",d.getValueOf("tab-properties","alt").replace(/^\s+/,"").replace(/\s+$/,""));var a={width:["width",
"width:#;","integer",1],height:["height","height:#;","integer",1],vmargin:["vspace","margin-top:#;margin-bottom:#;","integer",0],hmargin:["hspace","margin-left:#;margin-right:#;","integer",0],align:["align",""],border:["border","border:# solid black;","integer",0]},f=[],g,h,l,m;for(m in a){h=l=g=d.getValueOf("tab-properties",m);unit="px";if("align"==m)switch(g){case "top":case "bottom":a[m][1]="vertical-align:#;";break;case "left":case "right":a[m][1]="float:#;";break;default:g=null}"integer"==a[m][2]&&
(0<=g.indexOf("%")&&(unit="%"),g=parseInt(g,10),isNaN(g)?g=null:g<a[m][3]&&(g=null),null!=g&&("%"==unit?(l=g+"%",h=g+"%"):(l=g,h=g+"px")));null!=g&&(e.setAttribute(a[m][0],l),f.push(a[m][1].replace(/#/g,h)))}0<f.length&&e.setAttribute("style",f.join(""));b||c.insertElement(e);c.plugins.imageresize&&c.plugins.imageresize.resize(c,e,800,800)}},contents:[{id:"tab-source",label:c.lang.common.generalTab,elements:u},{id:"tab-properties",label:c.lang.common.advancedTab,elements:[{type:"text",id:"alt",label:c.lang.base64image.alt},
{type:"hbox",widths:["15%","15%","70%"],children:[{type:"text",width:"45px",id:"width",label:c.lang.common.width},{type:"text",width:"45px",id:"height",label:c.lang.common.height},{type:"checkbox",id:"lock",label:c.lang.base64image.lockRatio,style:"margin-top:18px;"}]},{type:"hbox",widths:["23%","30%","30%","17%"],style:"margin-top:10px;",children:[{type:"select",id:"align",label:c.lang.common.align,items:[[c.lang.common.notSet,"none"],[c.lang.common.alignTop,"top"],[c.lang.common.alignBottom,"bottom"],
[c.lang.common.alignLeft,"left"],[c.lang.common.alignRight,"right"]]},{type:"text",width:"45px",id:"vmargin",label:c.lang.base64image.vSpace},{type:"text",width:"45px",id:"hmargin",label:c.lang.base64image.hSpace},{type:"text",width:"45px",id:"border",label:c.lang.base64image.border}]}]}]}});